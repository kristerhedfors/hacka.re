<!DOCTYPE html>
<html lang="en" class="theme-modern">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hacka.re - Architecture</title>
    <meta name="description" content="Technical architecture of hacka.re, a serverless, streamlined chat interface for OpenAI-compatible AI models">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="css/themes.css">
    <!-- Font Awesome for icons (local) -->
    <link rel="stylesheet" href="../lib/font-awesome/all.min.css">
    <!-- Markdown parser (local) -->
    <script src="../lib/marked/marked.min.js"></script>
    <script src="../lib/dompurify/purify.min.js"></script>
    <style>
        .feature-section {
            margin: 40px 0;
        }

        .feature-section h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        @media (max-width: 768px) {
            .feature-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
        
        @media (max-width: 480px) {
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }

        .feature-card {
            background-color: var(--ai-msg-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
        }

        .feature-card h4 {
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .emoji-icon {
            font-size: 1.2em;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        .model-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .model-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }
        
        @media (max-width: 480px) {
            .model-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .model-card {
            background-color: var(--ai-msg-bg);
            border-radius: var(--border-radius);
            padding: 15px;
            box-shadow: var(--box-shadow);
        }
        
        .model-card h4 {
            margin-bottom: 8px;
            color: var(--primary-color);
        }
        
        .model-card p {
            margin: 5px 0;
            font-size: 0.9em;
        }
        
        .model-card .developer {
            font-weight: bold;
        }
        
        .model-card .context {
            color: var(--text-color);
            opacity: 0.7;
        }
        
        .code-block {
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: var(--border-radius);
            padding: 15px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .code-block pre {
            margin: 0;
            font-family: 'Courier New', Courier, monospace;
        }
        
        .important-notice {
            background-color: var(--system-msg-bg);
            border-left: 4px solid var(--accent-color);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <div class="logo">
                <h1 class="logo-text">hacka.re<span class="heart-logo">♥&#xFE0E;</span></h1>
                <p class="tagline">För hackare, av hackare.</p>
            </div>
            <nav>
                <a href="../index.html">Chat</a>
                <a href="index.html">About</a>
                <a href="architecture.html" class="active">Architecture</a>
                <a href="use-cases.html">Use Cases</a>
            </nav>
        </header>

        <main>
            <section class="content-section">
                <h2>Architecture</h2>
                <div class="important-notice">
                    <p>hacka.re is designed as a serverless, client-side application. This means all the core logic runs directly in your web browser. There's no backend server involved in processing your chats or storing your data, enhancing privacy and simplicity.</p>
                </div>
                <p>The application is built using standard web technologies:</p>
                <ul>
                    <li><strong>HTML:</strong> Structures the user interface.</li>
                    <li><strong>CSS:</strong> Styles the application, including themes.</li>
                    <li><strong>JavaScript:</strong> Handles all application logic, API interactions, data storage, and UI updates.</li>
                </ul>

                <h3>Key Components</h3>
                <ul>
                    <li><strong>UI Manager:</strong> Manages the overall user interface, including modals and theme switching.</li>
                    <li><strong>Chat Manager:</strong> Handles sending messages, receiving responses, displaying the chat history, and managing context.</li>
                    <li><strong>Settings Manager:</strong> Manages user settings like API keys, base URLs, selected models, and system prompts.</li>
                    <li><strong>Share Manager:</strong> Implements the secure link sharing functionality, including encryption and QR code generation.</li>
                    <li><strong>API Service:</strong> Communicates with the configured OpenAI-compatible API endpoint.</li>
                    <li><strong>Storage Service:</strong> Persists settings and chat history in the browser's `localStorage`.</li>
                    <li><strong>Crypto Utils:</strong> Provides cryptographic functions (using TweetNaCl) for secure link sharing.</li>
                </ul>

                <h3>Data Flow</h3>
                <ol>
                    <li>User enters a message and clicks send.</li>
                    <li>The Chat Manager captures the message, adds it to the current conversation history (stored locally).</li>
                    <li>The API Service constructs the request payload, including the message history and system prompt.</li>
                    <li>The request is sent directly from the browser to the user-configured API endpoint (e.g., Groq Cloud, OpenAI).</li>
                    <li>The API responds with the AI-generated message.</li>
                    <li>The API Service receives the response.</li>
                    <li>The Chat Manager processes the response (parsing Markdown, handling potential errors), updates the conversation history, and displays the message in the UI.</li>
                </ol>

                <h3>Security and Privacy</h3>
                <ul>
                    <li><strong>Local Storage:</strong> API keys, settings, and chat history are stored exclusively in the browser's `localStorage`. This data is never transmitted anywhere except directly to the chosen API provider during chat interactions.</li>
                    <li><strong>Serverless Design:</strong> The absence of a backend server eliminates a potential point of data collection or logging.</li>
                    <li><strong>Direct API Communication:</strong> The browser communicates directly with the AI provider's API, minimizing intermediaries.</li>
                    <li><strong>Encryption for Sharing:</strong> Shared links containing sensitive data (like API keys or conversation history) are encrypted using TweetNaCl (XSalsa20-Poly1305) with a user-provided session key. The raw data is embedded in the URL fragment identifier (`#`), which is typically not sent to web servers.</li>
                </ul>

                <h3>Third-Party Libraries</h3>
                <p>hacka.re utilizes the following self-hosted libraries:</p>
                <ul>
                    <li><strong>Marked.js:</strong> For parsing Markdown in chat messages.</li>
                    <li><strong>DOMPurify:</strong> To sanitize HTML generated from Markdown, preventing XSS attacks.</li>
                    <li><strong>TweetNaCl.js:</strong> For cryptographic operations used in link sharing.</li>
                    <li><strong>QRCode.js:</strong> To generate QR codes for shared links.</li>
                    <li><strong>Font Awesome:</strong> For icons.</li>
                </ul>
                <p>All libraries are included locally within the project to ensure the application can run offline and to maintain control over dependencies.</p>
            </section>
        </main>

        <footer>
            <p><a href="https://hacka.re" target="_blank">hacka.re</a> | <a href="index.html">About</a></p>
        </footer>
    </div>
    <script src="../js/themes.js"></script>
</body>
</html>
