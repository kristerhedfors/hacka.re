Starting HTTP server...
===== Starting HTTP Server for hacka.re Tests =====
Port: 8000
Project Root: /Users/user/dev/hacka.re
==================================================
Checking for existing HTTP server processes on port 8000...
No existing processes found on port 8000.
Changing to project root directory: /Users/user/dev/hacka.re
Starting Python HTTP server on port 8000...
Server started successfully with PID: 37048
Server is now running at http://localhost:8000
Server PID saved to: /Users/user/dev/hacka.re/_tests/playwright/server_pid.txt
==================================================
Server is ready. You can now run your tests.
To stop the server, run: kill -9 $(cat /Users/user/dev/hacka.re/_tests/playwright/server_pid.txt)
==================================================
==========================================
Running Modal-Related Tests
==========================================

----------------------------------------
Testing: Welcome Modal
Description: Basic welcome modal functionality
File: test_welcome_modal.py
----------------------------------------
⚠️  Test file not found: test_welcome_modal.py

----------------------------------------
Testing: Settings Modal
Description: Settings modal interactions and persistence
File: test_modals.py
----------------------------------------
============================= test session starts ==============================
platform darwin -- Python 3.13.3, pytest-8.3.5, pluggy-1.5.0 -- /Users/user/dev/hacka.re/_tests/playwright/.venv/bin/python
cachedir: .pytest_cache
rootdir: /Users/user/dev/hacka.re/_tests/playwright
configfile: pytest.ini
plugins: playwright-0.7.0, base-url-2.1.0
collecting ... collected 6 items

test_modals.py::test_settings_modal[chromium0] PASSED                    [ 16%]
test_modals.py::test_prompts_modal[chromium0] FAILED                     [ 33%]
test_modals.py::test_share_modal[chromium0] PASSED                       [ 50%]
test_modals.py::test_settings_modal[chromium1] PASSED                    [ 66%]
test_modals.py::test_prompts_modal[chromium1] PASSED                     [ 83%]
test_modals.py::test_share_modal[chromium1] PASSED                       [100%]

=================================== FAILURES ===================================
________________________ test_prompts_modal[chromium0] _________________________

page = <Page url='about:blank'>, serve_hacka_re = 'http://localhost:8000'

    def test_prompts_modal(page: Page, serve_hacka_re):
        """Test that the prompts modal opens and contains expected elements."""
        # Navigate to the application
>       page.goto(serve_hacka_re)

test_modals.py:49: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.13/site-packages/playwright/sync_api/_generated.py:9024: in goto
    self._sync(
.venv/lib/python3.13/site-packages/playwright/_impl/_page.py:552: in goto
    return await self._main_frame.goto(**locals_to_params(locals()))
.venv/lib/python3.13/site-packages/playwright/_impl/_frame.py:145: in goto
    await self._channel.send("goto", locals_to_params(locals()))
.venv/lib/python3.13/site-packages/playwright/_impl/_connection.py:61: in send
    return await self._connection.wrap_api_call(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <playwright._impl._connection.Connection object at 0x104de8440>
cb = <function Channel.send.<locals>.<lambda> at 0x1050e4a40>
is_internal = False

    async def wrap_api_call(
        self, cb: Callable[[], Any], is_internal: bool = False
    ) -> Any:
        if self._api_zone.get():
            return await cb()
        task = asyncio.current_task(self._loop)
        st: List[inspect.FrameInfo] = getattr(task, "__pw_stack__", inspect.stack())
        parsed_st = _extract_stack_trace_information_from_stack(st, is_internal)
        self._api_zone.set(parsed_st)
        try:
            return await cb()
        except Exception as error:
>           raise rewrite_error(error, f"{parsed_st['apiName']}: {error}") from None
E           playwright._impl._errors.Error: Page.goto: net::ERR_ABORTED at http://localhost:8000/
E           Call log:
E             - navigating to "http://localhost:8000/", waiting until "load"

.venv/lib/python3.13/site-packages/playwright/_impl/_connection.py:528: Error
--------------------------- Captured stdout teardown ---------------------------
HTTP server process already terminated
=========================== short test summary info ============================
FAILED test_modals.py::test_prompts_modal[chromium0] - playwright._impl._erro...
========================= 1 failed, 5 passed in 39.65s =========================
❌ Settings Modal: FAILED

----------------------------------------
Testing: API Key Modal
Description: API key configuration modal
File: test_api_key_modal.py
----------------------------------------
⚠️  Test file not found: test_api_key_modal.py

----------------------------------------
Testing: Function Modal
Description: Function calling modal UI
File: test_function_modal.py
----------------------------------------
Note: This test requires API key configuration
============================= test session starts ==============================
platform darwin -- Python 3.13.3, pytest-8.3.5, pluggy-1.5.0 -- /Users/user/dev/hacka.re/_tests/playwright/.venv/bin/python
cachedir: .pytest_cache
rootdir: /Users/user/dev/hacka.re/_tests/playwright
configfile: pytest.ini
plugins: playwright-0.7.0, base-url-2.1.0
collecting ... collected 4 items

test_function_modal.py::test_function_modal_basic[chromium0] PASSED      [ 25%]
test_function_modal.py::test_function_modal_elements[chromium0] PASSED   [ 50%]
test_function_modal.py::test_function_modal_basic[chromium1] PASSED      [ 75%]
test_function_modal.py::test_function_modal_elements[chromium1] PASSED   [100%]

============================== 4 passed in 32.92s ==============================
✅ Function Modal: PASSED

----------------------------------------
Testing: Share Modal
Description: Share functionality modal
File: test_share_modal.py
----------------------------------------
⚠️  Test file not found: test_share_modal.py

----------------------------------------
Testing: RAG Modal
Description: RAG knowledge base modal
File: test_rag_modal.py
----------------------------------------
============================= test session starts ==============================
platform darwin -- Python 3.13.3, pytest-8.3.5, pluggy-1.5.0 -- /Users/user/dev/hacka.re/_tests/playwright/.venv/bin/python
cachedir: .pytest_cache
rootdir: /Users/user/dev/hacka.re/_tests/playwright
configfile: pytest.ini
plugins: playwright-0.7.0, base-url-2.1.0
collecting ... collected 18 items

test_rag_modal.py::test_rag_button_visibility[chromium0] PASSED          [  5%]
test_rag_modal.py::test_rag_modal_open_close[chromium0] PASSED           [ 11%]
test_rag_modal.py::test_rag_modal_structure[chromium0] FAILED            [ 16%]
test_rag_modal.py::test_rag_modal_default_prompts_section[chromium0] FAILED [ 22%]
test_rag_modal.py::test_rag_modal_search_section[chromium0] FAILED       [ 27%]
test_rag_modal.py::test_rag_modal_user_bundles_section[chromium0] PASSED [ 33%]
test_rag_modal.py::test_rag_modal_keyboard_interaction[chromium0] PASSED [ 38%]
test_rag_modal.py::test_rag_enable_disable_functionality[chromium0] PASSED [ 44%]
test_rag_modal.py::test_rag_default_prompts_indexing_status[chromium0] FAILED [ 50%]
test_rag_modal.py::test_rag_button_visibility[chromium1] PASSED          [ 55%]
test_rag_modal.py::test_rag_modal_open_close[chromium1] PASSED           [ 61%]
test_rag_modal.py::test_rag_modal_structure[chromium1] PASSED            [ 66%]
test_rag_modal.py::test_rag_modal_default_prompts_section[chromium1] PASSED [ 72%]
test_rag_modal.py::test_rag_modal_search_section[chromium1] PASSED       [ 77%]
test_rag_modal.py::test_rag_modal_user_bundles_section[chromium1] FAILED [ 83%]
test_rag_modal.py::test_rag_modal_keyboard_interaction[chromium1] PASSED [ 88%]
test_rag_modal.py::test_rag_enable_disable_functionality[chromium1] PASSED [ 94%]
test_rag_modal.py::test_rag_default_prompts_indexing_status[chromium1] PASSED [100%]

=================================== FAILURES ===================================
_____________________ test_rag_modal_structure[chromium0] ______________________

page = <Page url='about:blank'>, serve_hacka_re = 'http://localhost:8000'

    def test_rag_modal_structure(page: Page, serve_hacka_re):
        """Test that the RAG modal contains all expected sections and elements."""
        # Navigate to the application
>       page.goto(serve_hacka_re)

test_rag_modal.py:70: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.13/site-packages/playwright/sync_api/_generated.py:9024: in goto
    self._sync(
.venv/lib/python3.13/site-packages/playwright/_impl/_page.py:552: in goto
    return await self._main_frame.goto(**locals_to_params(locals()))
.venv/lib/python3.13/site-packages/playwright/_impl/_frame.py:145: in goto
    await self._channel.send("goto", locals_to_params(locals()))
.venv/lib/python3.13/site-packages/playwright/_impl/_connection.py:61: in send
    return await self._connection.wrap_api_call(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <playwright._impl._connection.Connection object at 0x104f64440>
cb = <function Channel.send.<locals>.<lambda> at 0x1053176a0>
is_internal = False

    async def wrap_api_call(
        self, cb: Callable[[], Any], is_internal: bool = False
    ) -> Any:
        if self._api_zone.get():
            return await cb()
        task = asyncio.current_task(self._loop)
        st: List[inspect.FrameInfo] = getattr(task, "__pw_stack__", inspect.stack())
        parsed_st = _extract_stack_trace_information_from_stack(st, is_internal)
        self._api_zone.set(parsed_st)
        try:
            return await cb()
        except Exception as error:
>           raise rewrite_error(error, f"{parsed_st['apiName']}: {error}") from None
E           playwright._impl._errors.Error: Page.goto: net::ERR_SOCKET_NOT_CONNECTED at http://localhost:8000/
E           Call log:
E             - navigating to "http://localhost:8000/", waiting until "load"

.venv/lib/python3.13/site-packages/playwright/_impl/_connection.py:528: Error
--------------------------- Captured stdout teardown ---------------------------
HTTP server process already terminated
______________ test_rag_modal_default_prompts_section[chromium0] _______________

page = <Page url='about:blank'>, serve_hacka_re = 'http://localhost:8000'

    def test_rag_modal_default_prompts_section(page: Page, serve_hacka_re):
        """Test the default prompts section functionality."""
        # Navigate to the application
>       page.goto(serve_hacka_re)

test_rag_modal.py:117: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.13/site-packages/playwright/sync_api/_generated.py:9024: in goto
    self._sync(
.venv/lib/python3.13/site-packages/playwright/_impl/_page.py:552: in goto
    return await self._main_frame.goto(**locals_to_params(locals()))
.venv/lib/python3.13/site-packages/playwright/_impl/_frame.py:145: in goto
    await self._channel.send("goto", locals_to_params(locals()))
.venv/lib/python3.13/site-packages/playwright/_impl/_connection.py:61: in send
    return await self._connection.wrap_api_call(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <playwright._impl._connection.Connection object at 0x104f64440>
cb = <function Channel.send.<locals>.<lambda> at 0x1052c5120>
is_internal = False

    async def wrap_api_call(
        self, cb: Callable[[], Any], is_internal: bool = False
    ) -> Any:
        if self._api_zone.get():
            return await cb()
        task = asyncio.current_task(self._loop)
        st: List[inspect.FrameInfo] = getattr(task, "__pw_stack__", inspect.stack())
        parsed_st = _extract_stack_trace_information_from_stack(st, is_internal)
        self._api_zone.set(parsed_st)
        try:
            return await cb()
        except Exception as error:
>           raise rewrite_error(error, f"{parsed_st['apiName']}: {error}") from None
E           playwright._impl._errors.Error: Page.goto: net::ERR_SOCKET_NOT_CONNECTED at http://localhost:8000/
E           Call log:
E             - navigating to "http://localhost:8000/", waiting until "load"

.venv/lib/python3.13/site-packages/playwright/_impl/_connection.py:528: Error
--------------------------- Captured stdout teardown ---------------------------
HTTP server process already terminated
___________________ test_rag_modal_search_section[chromium0] ___________________

page = <Page url='about:blank'>, serve_hacka_re = 'http://localhost:8000'

    def test_rag_modal_search_section(page: Page, serve_hacka_re):
        """Test the search section functionality."""
        # Navigate to the application
>       page.goto(serve_hacka_re)

test_rag_modal.py:148: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.13/site-packages/playwright/sync_api/_generated.py:9024: in goto
    self._sync(
.venv/lib/python3.13/site-packages/playwright/_impl/_page.py:552: in goto
    return await self._main_frame.goto(**locals_to_params(locals()))
.venv/lib/python3.13/site-packages/playwright/_impl/_frame.py:145: in goto
    await self._channel.send("goto", locals_to_params(locals()))
.venv/lib/python3.13/site-packages/playwright/_impl/_connection.py:61: in send
    return await self._connection.wrap_api_call(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <playwright._impl._connection.Connection object at 0x104f64440>
cb = <function Channel.send.<locals>.<lambda> at 0x1052c6b60>
is_internal = False

    async def wrap_api_call(
        self, cb: Callable[[], Any], is_internal: bool = False
    ) -> Any:
        if self._api_zone.get():
            return await cb()
        task = asyncio.current_task(self._loop)
        st: List[inspect.FrameInfo] = getattr(task, "__pw_stack__", inspect.stack())
        parsed_st = _extract_stack_trace_information_from_stack(st, is_internal)
        self._api_zone.set(parsed_st)
        try:
            return await cb()
        except Exception as error:
>           raise rewrite_error(error, f"{parsed_st['apiName']}: {error}") from None
E           playwright._impl._errors.Error: Page.goto: net::ERR_SOCKET_NOT_CONNECTED at http://localhost:8000/
E           Call log:
E             - navigating to "http://localhost:8000/", waiting until "load"

.venv/lib/python3.13/site-packages/playwright/_impl/_connection.py:528: Error
--------------------------- Captured stdout teardown ---------------------------
HTTP server process already terminated
_____________ test_rag_default_prompts_indexing_status[chromium0] ______________

page = <Page url='about:blank'>, serve_hacka_re = 'http://localhost:8000'

    def test_rag_default_prompts_indexing_status(page: Page, serve_hacka_re):
        """Test that default prompts show their indexing status."""
        # Navigate to the application
>       page.goto(serve_hacka_re)

test_rag_modal.py:289: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.13/site-packages/playwright/sync_api/_generated.py:9024: in goto
    self._sync(
.venv/lib/python3.13/site-packages/playwright/_impl/_page.py:552: in goto
    return await self._main_frame.goto(**locals_to_params(locals()))
.venv/lib/python3.13/site-packages/playwright/_impl/_frame.py:145: in goto
    await self._channel.send("goto", locals_to_params(locals()))
.venv/lib/python3.13/site-packages/playwright/_impl/_connection.py:61: in send
    return await self._connection.wrap_api_call(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <playwright._impl._connection.Connection object at 0x104f64440>
cb = <function Channel.send.<locals>.<lambda> at 0x10536f600>
is_internal = False

    async def wrap_api_call(
        self, cb: Callable[[], Any], is_internal: bool = False
    ) -> Any:
        if self._api_zone.get():
            return await cb()
        task = asyncio.current_task(self._loop)
        st: List[inspect.FrameInfo] = getattr(task, "__pw_stack__", inspect.stack())
        parsed_st = _extract_stack_trace_information_from_stack(st, is_internal)
        self._api_zone.set(parsed_st)
        try:
            return await cb()
        except Exception as error:
>           raise rewrite_error(error, f"{parsed_st['apiName']}: {error}") from None
E           playwright._impl._errors.Error: Page.goto: net::ERR_SOCKET_NOT_CONNECTED at http://localhost:8000/
E           Call log:
E             - navigating to "http://localhost:8000/", waiting until "load"

.venv/lib/python3.13/site-packages/playwright/_impl/_connection.py:528: Error
--------------------------- Captured stdout teardown ---------------------------
HTTP server process already terminated
________________ test_rag_modal_user_bundles_section[chromium1] ________________

page = <Page url='http://localhost:8000/'>
serve_hacka_re = 'http://localhost:8000'

    def test_rag_modal_user_bundles_section(page: Page, serve_hacka_re):
        """Test the user bundles section functionality."""
        # Navigate to the application
        page.goto(serve_hacka_re)
    
        # Dismiss welcome modal if present
        dismiss_welcome_modal(page)
        # Open the RAG modal
        rag_button = page.locator("#rag-btn")
        rag_button.click()
    
        # Wait for modal to become visible
>       page.wait_for_selector("#rag-modal", state="visible", timeout=3000)

test_rag_modal.py:200: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.13/site-packages/playwright/sync_api/_generated.py:8187: in wait_for_selector
    self._sync(
.venv/lib/python3.13/site-packages/playwright/_impl/_page.py:425: in wait_for_selector
    return await self._main_frame.wait_for_selector(**locals_to_params(locals()))
.venv/lib/python3.13/site-packages/playwright/_impl/_frame.py:323: in wait_for_selector
    await self._channel.send("waitForSelector", locals_to_params(locals()))
.venv/lib/python3.13/site-packages/playwright/_impl/_connection.py:61: in send
    return await self._connection.wrap_api_call(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <playwright._impl._connection.Connection object at 0x104f64440>
cb = <function Channel.send.<locals>.<lambda> at 0x10536e700>
is_internal = False

    async def wrap_api_call(
        self, cb: Callable[[], Any], is_internal: bool = False
    ) -> Any:
        if self._api_zone.get():
            return await cb()
        task = asyncio.current_task(self._loop)
        st: List[inspect.FrameInfo] = getattr(task, "__pw_stack__", inspect.stack())
        parsed_st = _extract_stack_trace_information_from_stack(st, is_internal)
        self._api_zone.set(parsed_st)
        try:
            return await cb()
        except Exception as error:
>           raise rewrite_error(error, f"{parsed_st['apiName']}: {error}") from None
E           playwright._impl._errors.TimeoutError: Page.wait_for_selector: Timeout 3000ms exceeded.
E           Call log:
E             - waiting for locator("#rag-modal") to be visible
E               11 × locator resolved to hidden <div class="modal" id="rag-modal">…</div>

.venv/lib/python3.13/site-packages/playwright/_impl/_connection.py:528: TimeoutError
----------------------------- Captured stdout call -----------------------------
welcome-modal is visible, closing it
Found close button with selector: #close-welcome-modal
Clicked close button
Modal closed successfully
--------------------------- Captured stdout teardown ---------------------------
HTTP server process already terminated
=========================== short test summary info ============================
FAILED test_rag_modal.py::test_rag_modal_structure[chromium0] - playwright._i...
FAILED test_rag_modal.py::test_rag_modal_default_prompts_section[chromium0]
FAILED test_rag_modal.py::test_rag_modal_search_section[chromium0] - playwrig...
FAILED test_rag_modal.py::test_rag_default_prompts_indexing_status[chromium0]
FAILED test_rag_modal.py::test_rag_modal_user_bundles_section[chromium1] - pl...
=================== 5 failed, 13 passed in 88.79s (0:01:28) ====================
❌ RAG Modal: FAILED
  ⚠️  Timeout waiting for modal - possible unexpected modal popup

----------------------------------------
Testing: Modal Coordination
Description: Multiple modal interactions
File: test_modal_coordination.py
----------------------------------------
⚠️  Test file not found: test_modal_coordination.py

==========================================
Modal Test Summary
==========================================
Total test groups: 3
Passed: 1
Failed: 2

No arguments provided. Using default files.
Processing default files...
Generating markdown report for 'test_output.log' -> 'test_results.md'...
Markdown report generated: test_results.md
You can view it with: glow -p test_results.md
Warning: Output file 'run_tests.out_bundle.md' is newer than input file 'run_tests.out'.
This suggests the bundle has already been generated for this test run.
To regenerate, delete 'run_tests.out_bundle.md' first.
Output saved to: run_modal_tests.out
Individual logs saved as: modal_test_*.log
===== Stopping HTTP Server for hacka.re Tests =====
Found server process with PID: 37169
Stopping server...
Server stopped.
Removed PID file: /Users/user/dev/hacka.re/_tests/playwright/server_pid.txt
==================================================
