<!DOCTYPE html>
<html lang="en" class="theme-modern">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green Wave Heart Animation Test</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/themes.css">
    <style>
        body {
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .test-container {
            margin-bottom: 20px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        button {
            padding: 8px 16px;
            background-color: #6366f1;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        input {
            padding: 8px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        h2 {
            margin-top: 0;
        }
        
        /* Double the size of the heart */
        .heart-logo {
            font-size: 3rem !important; /* Double the original 1.5rem size */
        }
        
        /* Green wave animation styles */
        .green-wave-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
            z-index: 1;
        }
        
        .green-dot {
            position: absolute;
            width: 2px;
            height: 2px;
            background-color: #22CC22;
            border-radius: 50%;
            opacity: 0;
            z-index: 1;
        }
    </style>
    <!-- Markdown parser (local) -->
    <script src="lib/marked/marked.min.js"></script>
    <script src="lib/dompurify/purify.min.js"></script>
    <!-- TweetNaCl for encryption (local) -->
    <script src="lib/tweetnacl/nacl-fast.min.js"></script>
    <script src="lib/tweetnacl/nacl-util.min.js"></script>
</head>
<body>
    <h1>Green Wave Heart Animation Test</h1>
    
    <div class="test-container">
        <h2>Original Logo</h2>
        <div class="logo">
            <h1 class="logo-text">hacka.re<span class="heart-logo">♥&#xFE0E;
                <!-- SVG fallback for Firefox Focus -->
                <svg class="firefox-focus-fallback" width="16" height="6" viewBox="0 0 16 6" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 3; display: none;">
                    <circle cx="3" cy="3" r="1.5" fill="#22CC22" />
                    <circle cx="8" cy="3" r="1.5" fill="#22CC22" />
                    <circle cx="13" cy="3" r="1.5" fill="#22CC22" />
                </svg>
                <div class="typing-dots"></div>
                <div class="tooltip">
                    <p>This is a tooltip</p>
                </div>
                <!-- Add green wave container -->
                <div class="green-wave-container"></div>
            </span></h1>
            <p class="tagline">Free, open, för hackare, av hackare.</p>
        </div>
    </div>
    
    <div class="test-container">
        <h2>Animation Controls</h2>
        <button id="start-animation">Start Animation</button>
        <button id="stop-animation">Stop Animation</button>
        <button id="toggle-wave">Toggle Green Wave</button>
    </div>

    <script>
        // Green Wave Animation
        const GreenWaveAnimation = (function() {
            let isRunning = false;
            let animationFrameId = null;
            let dots = [];
            let heartElement = null;
            let waveContainer = null;
            
            // Configuration
            const config = {
                maxDots: 200,          // Maximum number of dots
                dotSize: [1, 3],       // Min and max dot size
                angle: 45,             // Angle in degrees
                speed: [0.5, 2],       // Min and max speed
                wavePeriod: 3000,      // Time for a complete wave cycle in ms
                waveFrequency: 0.5,    // How many waves appear at once
                greenIntensity: 0.3    // Ratio of green peaks to black/gray troughs (lower = more troughs)
            };
            
            function init() {
                heartElement = document.querySelector('.heart-logo');
                waveContainer = heartElement.querySelector('.green-wave-container');
                
                if (!heartElement || !waveContainer) return;
                
                // Clear any existing dots
                waveContainer.innerHTML = '';
                dots = [];
                
                // Create dots
                createDots();
            }
            
            function createDots() {
                // Get heart dimensions and position
                const heartRect = heartElement.getBoundingClientRect();
                
                // Create dots
                for (let i = 0; i < config.maxDots; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'green-dot';
                    
                    // Random size between min and max
                    const size = Math.random() * (config.dotSize[1] - config.dotSize[0]) + config.dotSize[0];
                    dot.style.width = `${size}px`;
                    dot.style.height = `${size}px`;
                    
                    // Random position within the heart
                    const x = Math.random() * heartRect.width;
                    const y = Math.random() * heartRect.height;
                    
                    // Store original position for animation
                    const dotData = {
                        element: dot,
                        x: x,
                        y: y,
                        size: size,
                        speed: Math.random() * (config.speed[1] - config.speed[0]) + config.speed[0],
                        offset: Math.random() * config.wavePeriod // Random start position in the wave
                    };
                    
                    // Position the dot
                    dot.style.left = `${x}px`;
                    dot.style.top = `${y}px`;
                    
                    waveContainer.appendChild(dot);
                    dots.push(dotData);
                }
            }
            
            function start() {
                if (isRunning) return;
                
                isRunning = true;
                animate();
            }
            
            function stop() {
                isRunning = false;
                
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
                
                // Hide all dots
                dots.forEach(dot => {
                    dot.element.style.opacity = '0';
                });
            }
            
            function animate() {
                if (!isRunning) return;
                
                const now = Date.now();
                const angleRad = config.angle * (Math.PI / 180); // Convert angle to radians
                
                dots.forEach(dot => {
                    // Calculate wave phase based on position and time
                    const wavePhase = (dot.x * Math.cos(angleRad) + dot.y * Math.sin(angleRad)) / 20 + 
                                     (now + dot.offset) / config.wavePeriod * Math.PI * 2;
                    
                    // Calculate wave amplitude (0 to 1)
                    const waveValue = (Math.sin(wavePhase * config.waveFrequency) + 1) / 2;
                    
                    // Apply green intensity threshold - only show dots when wave value is high enough
                    if (waveValue > (1 - config.greenIntensity)) {
                        // Map wave value to opacity (more intense at peaks)
                        const opacity = (waveValue - (1 - config.greenIntensity)) / config.greenIntensity;
                        dot.element.style.opacity = opacity.toFixed(2);
                        
                        // Brighter green at wave peaks
                        const greenIntensity = Math.floor(180 + 75 * opacity); // 180-255 range for green
                        dot.element.style.backgroundColor = `rgb(0, ${greenIntensity}, 0)`;
                    } else {
                        // Hide dots in troughs
                        dot.element.style.opacity = '0';
                    }
                });
                
                animationFrameId = requestAnimationFrame(animate);
            }
            
            return {
                init: init,
                start: start,
                stop: stop
            };
        })();
        
        // Load the original logo animation script
        const originalScript = document.createElement('script');
        originalScript.src = 'js/logo-animation.js';
        document.head.appendChild(originalScript);
        
        // Initialize the green wave animation
        document.addEventListener('DOMContentLoaded', function() {
            GreenWaveAnimation.init();
            
            // Set up event listeners for buttons
            document.getElementById('start-animation').addEventListener('click', function() {
                GreenWaveAnimation.start();
                console.log('Green wave animation started');
            });
            
            document.getElementById('stop-animation').addEventListener('click', function() {
                GreenWaveAnimation.stop();
                console.log('Green wave animation stopped');
            });
            
            document.getElementById('toggle-wave').addEventListener('click', function() {
                const isRunning = document.querySelector('.green-dot').style.opacity !== '0';
                if (isRunning) {
                    GreenWaveAnimation.stop();
                    console.log('Green wave animation stopped');
                } else {
                    GreenWaveAnimation.start();
                    console.log('Green wave animation started');
                }
            });
            
            // Trigger a custom event to start the animation for testing
            document.getElementById('start-animation').addEventListener('click', function() {
                document.dispatchEvent(new CustomEvent('ai-response-start'));
            });
            
            document.getElementById('stop-animation').addEventListener('click', function() {
                document.dispatchEvent(new CustomEvent('ai-response-end'));
            });
        });
    </script>
</body>
</html>
