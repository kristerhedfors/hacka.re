<html lang="en" class="theme-modern">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hacka.re - Chat with AI Models</title>
    <meta name="description" content="A simple chat interface for OpenAI-compatible APIs">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="css/mobile.css">
    <link rel="stylesheet" href="css/copy-code.css">
    <link rel="stylesheet" href="css/default-prompts.css">
    <!-- Font Awesome for icons (local) -->
    <link rel="stylesheet" href="lib/font-awesome/all.min.css">
    <!-- Markdown parser (local) -->
    <script src="lib/marked/marked.min.js"></script>
    <script src="lib/dompurify/purify.min.js"></script>
    <!-- TweetNaCl for encryption (local) -->
    <script src="lib/tweetnacl/nacl-fast.min.js"></script>
    <script src="lib/tweetnacl/nacl-util.min.js"></script
    <!-- QRCode.js for QR code generation (local) -->
    <script src="lib/qrcode/qrcode.min.js"></script>
</head>
<body>
    <div class="app-container">
        <header>
            <span class="beta-tag">BETA</span>
            <div class="logo">
                <h1 class="logo-text">hacka.re<span class="heart-logo">♥&#xFE0E;
                    <!-- SVG fallback for Firefox Focus -->
                    <svg class="firefox-focus-fallback" width="16" height="6" viewBox="0 0 16 6" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 3; display: none;">
                        <circle cx="3" cy="3" r="1.5" fill="#22CC22" />
                        <circle cx="8" cy="3" r="1.5" fill="#22CC22" />
                        <circle cx="13" cy="3" r="1.5" fill="#22CC22" />
                    </svg>
                    <div class="typing-dots"></div>
                    <div class="tooltip">
                        <div class="important-notice" style="background-color: var(--system-msg-bg); border-left: 4px solid var(--accent-color); padding: 10px; margin-bottom: 10px; border-radius: 8px;">
                            <p><strong>hacka.re</strong>: Privacy-focused chat client that stores API keys, conversations, and settings locally in your browser.</p>
                        </div>
                        <div class="important-notice" style="background-color: var(--system-msg-bg); border-left: 4px solid var(--accent-color); padding: 10px; margin-bottom: 10px; border-radius: 8px;">
                            <p><strong>Features</strong>: Serverless, offline-capable, MIT licensed. Create encrypted, password-protected GPTs with custom prompts.</p>
                        </div>
                        <div class="important-notice" style="background-color: var(--system-msg-bg); border-left: 4px solid var(--accent-color); padding: 10px; margin-bottom: 10px; border-radius: 8px;">
                            <p><strong>Get started</strong>: Configure with base URL (OpenAI-compatible) and API key.</p>
                        </div>
                        <div class="important-notice" style="background-color: var(--system-msg-bg); border-left: 4px solid var(--accent-color); padding: 10px; margin-bottom: 0; border-radius: 8px;">
                            <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;"><i class="fas fa-magic"></i> <strong>Vibe-Coded</strong> with Claude 3.7 Sonnet | <a href="about/index.html">About</a> | <a href="about/development.html">Development</a> | <a href="about/disclaimer.html">Disclaimer</a></p>
                        </div>
                    </div>
                </span></h1>
                <p class="tagline">För hackare, av hackare.</p>
            </div>
            <div class="model-info">
                <div class="model-name-display"></div>
                <div class="model-stats">
                    <span class="model-context"></span>
                    <span class="context-usage">
                        <div class="usage-bar">
                            <div class="usage-fill" style="width: 0%"></div>
                        </div>
                        <span class="usage-text">0%</span>
                    </span>
                    <span class="token-speed">
                        <span class="token-speed-text">0 t/s</span>
                    </span>
                </div>
            </div>
            <div class="settings">
                <!-- MCP button temporarily removed - functionality under development -->
                <button id="prompts-btn" class="icon-btn" title="System Prompt Menu">
                    <i class="fas fa-list-alt"></i>
                </button>
                <button id="share-btn" class="icon-btn" title="Share">
                    <i class="fas fa-share-alt"></i>
                </button>
                <button id="theme-toggle-btn" class="icon-btn" title="Cycle Theme">
                    <i class="fas fa-paint-brush"></i>
                </button>
                <button id="settings-btn" class="icon-btn" title="Settings">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </header>

        <div id="api-key-modal" class="modal">
            <div class="modal-content">
                <h2>Enter your API Key</h2>
                <p>Your API key is stored locally in your browser and never sent to any server other than your configured API provider.</p>
                <form id="api-key-form">
                    <div class="form-group">
                        <label for="api-key">API Key</label>
                        <input type="password" id="api-key" placeholder="Enter your API key" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn primary-btn">Save API Key</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="share-modal" class="modal">
            <div class="modal-content">
                <h2>Share Link</h2>
                <form id="share-form">
                    <div class="form-group">
                        <label for="share-password">
                            Password / Session Key
                            <span class="info-icon">
                                <i class="fas fa-info-circle"></i>
                                <span class="tooltip">A password/session key is used to encrypt shared links and local data. There are no accounts or login functions - hacka.re is a static client-side application with no server component. Your API keys and data never leave your browser except when communicating directly with your chosen LLM provider. The encrypted data in shared links is processed entirely in the browser and never reaches any server. All data stored in your browser's localStorage is also encrypted using this key. The security of your data relies entirely on the strength of this password/session key.</span>
                            </span>
                        </label>
                        <div class="password-input-container">
                            <input type="password" id="share-password" placeholder="Password/session key for encryption">
                            <button type="button" class="icon-btn" id="regenerate-password" title="Generate strong password/session key">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button type="button" class="icon-btn" id="toggle-password-visibility" title="Show/hide password/session key">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button type="button" class="icon-btn" id="copy-password" title="Copy password/session key">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <div class="checkbox-group" style="margin-top: 8px;">
                            <input type="checkbox" id="lock-session-key">
                            <label for="lock-session-key">Lock password/session key</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>What to share
                            <span class="info-icon">
                                <i class="fas fa-info-circle"></i>
                                <span class="tooltip">
                                    <p>Practical limits for shared links:</p>
                                    <ul>
                                        <li>Browser URL limit: ~2000 bytes (may vary by browser)</li>
                                        <li>QR code limit: ~1500 bytes for reliable scanning</li>
                                        <li>Mobile devices: Keep under 1000 bytes for best compatibility</li>
                                        <li>Email sharing: Under 2000 bytes to avoid truncation</li>
                                        <li>SMS/messaging: Under 500 bytes recommended</li>
                                    </ul>
                                    <p>The link length bar below shows the estimated size relative to browser limits.</p>
                                </span>
                            </span>
                        </label>
                        <div class="link-length-container">
                            <div class="link-length-label">
                                Estimated link length: <span id="link-length-text">0</span> bytes
                                <span id="link-length-warning" class="link-length-warning">Exceeds recommended limit</span>
                            </div>
                            <div class="link-length-bar">
                                <div class="link-length-fill" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="share-options">
                            <div class="checkbox-group">
                                <input type="checkbox" id="share-base-url">
                                <label for="share-base-url">Base URL</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="share-api-key" checked>
                                <label for="share-api-key">API key</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="share-model">
                                <label for="share-model">Active model</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="share-prompt-library">
                                <label for="share-prompt-library">Prompt library</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="share-conversation">
                                <label for="share-conversation">Conversation data</label>
                            </div>
                            
                            <div class="message-history-container">
                                <label for="message-history-count">Messages to include:</label>
                                <input type="number" id="message-history-count" value="1" min="1" disabled>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Branding</label>
                        <div class="branding-options">
                            <div class="input-group">
                                <label for="share-title">Title:</label>
                                <input type="text" id="share-title" placeholder="hacka.re">
                            </div>
                            
                            <div class="input-group">
                                <label for="share-subtitle">Subtitle:</label>
                                <input type="text" id="share-subtitle" placeholder="För hackare, av hackare">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn primary-btn" id="generate-share-link-btn">Generate Link</button>
                        <button type="button" class="btn secondary-btn" id="close-share-modal">Cancel</button>
                    </div>
                </form>
                
                <div id="generated-link-container" style="display: none;">
                    <h3>Your Shareable Link</h3>
                    <div class="link-display">
                        <input type="text" id="generated-link" readonly>
                        <button type="button" class="btn icon-btn" id="copy-generated-link" title="Copy to clipboard">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div id="share-qr-code-container" style="margin-top: 15px; text-align: center;"></div>
                    <div id="qr-code-warning" style="display: none; margin-top: 10px; color: #856404; background-color: #fff3cd; padding: 10px; border-radius: 5px;"></div>
                </div>
            </div>
        </div>
        
        <div id="prompts-modal" class="modal">
            <div class="modal-content">
                <div class="settings-header">
                    <h2>System Prompt Menu</h2>
                </div>
                <div class="prompts-container single-column">
                    <h3>System prompt components</h3>
                    <p class="form-help">Check the boxes for the prompts to include in system prompt</p>
                    <div id="prompts-list">
                        <!-- Prompts will be populated here -->
                    </div>
                    <div class="form-actions" style="margin-top: 15px;">
                        <button type="button" id="close-prompts-modal" class="btn secondary-btn">Close</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="mcp-modal" class="modal">
            <div class="modal-content">
                <div class="settings-header">
                    <h2>Model Context Protocol (MCP)</h2>
                    <span class="info-icon" id="mcp-info-icon">
                        <i class="fas fa-info-circle"></i>
                        <div class="tooltip">
                            <div class="tooltip-content">
                                <div class="important-notice">
                                    <p><strong>Model Context Protocol (MCP)</strong>: Extend AI capabilities by connecting to MCP servers that provide additional tools and resources.</p>
                                </div>
                                <div class="important-notice">
                                    <p><strong>MCP Servers</strong>: Add servers to enable tool calling and access to external resources like APIs, databases, and more.</p>
                                </div>
                                <div class="important-notice">
                                    <p><strong>Privacy</strong>: Server configurations are stored locally in your browser. No data is sent to external servers unless explicitly configured.</p>
                                </div>
                            </div>
                        </div>
                    </span>
                </div>
                <div class="mcp-container">
                    <div class="mcp-servers-section">
                        <h3>MCP Servers</h3>
                        <p class="form-help">Add and manage MCP servers to extend AI capabilities with additional tools and resources.</p>
                        <div id="mcp-servers-list">
                            <!-- MCP servers will be populated here -->
                            <div class="empty-state" id="mcp-empty-state">
                                <p>No MCP servers configured. Add a server to enable tool calling.</p>
                            </div>
                        </div>
                        
                        <div class="mcp-add-server-section">
                            <h4>Add MCP Server</h4>
                            <form id="mcp-add-server-form">
                                <div class="form-group">
                                    <label for="mcp-server-name">Server Name</label>
                                    <input type="text" id="mcp-server-name" placeholder="Enter a name for this server" required>
                                </div>
                                <div class="form-group">
                                    <label for="mcp-server-url">Server URL</label>
                                    <input type="text" id="mcp-server-url" placeholder="URL to connect to the server (e.g., http://localhost:8000)" required>
                                    <p class="form-help">The URL where the MCP server is accessible (required for network-based connections)</p>
                                </div>
                                <div class="form-group">
                                    <label for="mcp-server-command">Server Command (reference only)</label>
                                    <input type="text" id="mcp-server-command" placeholder="Command used to start the server (for reference only)">
                                    <p class="form-help">This is just for documentation - commands cannot be executed from the browser</p>
                                </div>
                                <div class="form-group">
                                    <label for="mcp-server-env">Environment Variables (optional)</label>
                                    <textarea id="mcp-server-env" placeholder="KEY1=value1&#10;KEY2=value2"></textarea>
                                    <p class="form-help">One environment variable per line in KEY=value format</p>
                                </div>
                                <div class="form-actions" style="margin-top: 15px;">
                                    <button type="submit" class="btn primary-btn">Add Server</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div class="form-actions" style="margin-top: 15px;">
                        <button type="button" id="close-mcp-modal" class="btn secondary-btn">Close</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="settings-modal" class="modal">
            <div class="modal-content">
                <div class="settings-header">
                    <h2>Settings</h2>
                    <span class="info-icon" id="settings-info-icon">
                        <i class="fas fa-info-circle"></i>
                        <div class="tooltip">
                            <div class="tooltip-content">
                                <div class="important-notice" style="background-color: var(--system-msg-bg); border-left: 4px solid var(--accent-color); padding: 10px; margin-bottom: 10px; border-radius: 8px;">
                                    <p><strong>hacka.re</strong>: Privacy-focused chat client that stores API keys, conversations, and settings locally in your browser.</p>
                                </div>
                                <div class="important-notice" style="background-color: var(--system-msg-bg); border-left: 4px solid var(--accent-color); padding: 10px; margin-bottom: 10px; border-radius: 8px;">
                                    <p><strong>Features</strong>: Serverless, offline-capable, MIT licensed. Create encrypted, password-protected GPTs with custom prompts.</p>
                                </div>
                                <div class="important-notice" style="background-color: var(--system-msg-bg); border-left: 4px solid var(--accent-color); padding: 10px; margin-bottom: 10px; border-radius: 8px;">
                                    <p><strong>Get started</strong>: Configure with base URL (OpenAI-compatible) and API key.</p>
                                </div>
                                <div class="important-notice" style="background-color: var(--system-msg-bg); border-left: 4px solid var(--accent-color); padding: 10px; margin-bottom: 0; border-radius: 8px;">
                                    <p style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;"><i class="fas fa-magic"></i> <strong>Vibe-Coded</strong> with Claude 3.7 Sonnet | <a href="about/index.html">About</a> | <a href="about/development.html">Development</a> | <a href="about/disclaimer.html">Disclaimer</a></p>
                                </div>
                            </div>
                        </div>
                    </span>
                </div>
                <form id="settings-form">
                    <div class="form-group">
                        <label for="base-url-select">API Provider</label>
                        <select id="base-url-select">
                            <option value="groq">Groq Cloud (api.groq.com/openai/v1)</option>
                            <option value="openai">OpenAI (api.openai.com/v1)</option>
                            <option value="ollama">Ollama (localhost:11434/v1)</option>
                            <option value="custom">User-defined</option>
                        </select>
                    </div>
                    <div class="form-group" id="custom-base-url-group" style="display: none;">
                        <label for="base-url">Custom Base URL</label>
                        <input type="text" id="base-url" placeholder="Enter custom API base URL">
                    </div>
                    <div class="form-group">
                        <label for="api-key-update">API Key</label>
                        <input type="password" id="api-key-update" name="api-key-update" placeholder="Update your API key" aria-label="API Key Input">
                    </div>
                    <div class="form-group">
                        <label for="model-select">Model</label>
                        <div style="display: flex; align-items: center;">
                            <select id="model-select" style="flex-grow: 1;"></select>
                            <button type="button" id="model-reload-btn" class="icon-btn" title="Reload models from API" style="margin-left: 8px;">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>System Prompt</label>
                        <div class="form-help">
                            The system prompt is composed of the checked prompts in the prompt library of the <a href="#" id="open-prompts-config" style="color: blue; text-decoration: underline;">System Prompt Menu</a>.
                        </div>
                        <div id="system-prompt-preview" style="background-color: var(--bg-color-secondary); padding: 10px; border-radius: 5px; max-height: 100px; overflow-y: auto; display: none;">
                            <p style="margin: 0; font-style: italic; color: var(--text-color-secondary);">Current system prompt preview</p>
                        </div>
                    </div>
                    <div class="form-actions">
                        <a href="#" id="clear-all-settings" style="color: blue; margin-right: auto;">Clear all settings</a>
                        <button type="submit" class="btn primary-btn" id="save-settings-btn" name="save-settings-btn" aria-label="Save Settings Button">Save Settings</button>
                        <button type="button" class="btn secondary-btn" id="close-settings" name="close-settings" aria-label="Cancel Button">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <main>
            <div id="chat-container">
                <div id="chat-messages">
                    <div class="message system">
                        <div class="message-content">
                            <p>Welcome to hacka.re! Start a conversation with AI models.</p>
                        </div>
                    </div>
                </div>
                <div id="chat-input-container">
                    <form id="chat-form">
                        <textarea id="message-input" placeholder="Type your message here..." rows="1"></textarea>
                        <button type="submit" id="send-btn" class="icon-btn" title="Send message" name="send-message-button" aria-label="Send Message Button">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </form>
                    <div class="chat-actions">
                        <a href="#" id="clear-chat">Clear Chat</a>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p><a href="https://hacka.re" target="_blank">hacka.re</a> | <a href="about/index.html">About</a> | <a href="about/disclaimer.html">Disclaimer</a></p>
        </footer>
    </div>

    <script src="js/utils/crypto-utils.js"></script>
    <script src="js/services/model-info.js"></script>
    <script src="js/services/encryption-service.js"></script>
    <script src="js/services/namespace-service.js"></script>
    <script src="js/services/core-storage-service.js"></script>
    <script src="js/services/data-service.js"></script>
    <script src="js/services/storage-service.js"></script>
    <script src="js/services/api-service.js"></script>
    <script src="js/services/api-tools-service.js"></script>
    <script src="js/services/mcp-service.js"></script>
    <script src="js/services/link-sharing-service.js"></script>
    <script src="js/services/share-service.js"></script>
    <!-- Default prompts -->
    <script src="js/default-prompts/hacka-re-project.js"></script>
    <script src="js/default-prompts/function-calling.js"></script>
    <script src="js/default-prompts/mcp-prompt.js"></script>
    <script src="js/default-prompts/owasp-llm-top10.js"></script>
    <script src="js/default-prompts/mcp-sdk-readme.js"></script>
    <script src="js/services/default-prompts-service.js"></script>
    <script src="js/services/prompts-service.js"></script>
    <script src="js/utils/ui-utils.js"></script>
    <!-- Component modules -->
    <script src="js/components/dom-elements.js"></script>
    <script src="js/components/ui-manager.js"></script>
    <script src="js/components/chat-manager.js"></script>
    <!-- Settings Manager Components -->
    <script src="js/components/settings/api-key-manager.js"></script>
    <script src="js/components/settings/model-manager.js"></script>
    <script src="js/components/settings/system-prompt-manager.js"></script>
    <script src="js/components/settings/base-url-manager.js"></script>
    <script src="js/components/settings/title-subtitle-manager.js"></script>
    <script src="js/components/settings/welcome-manager.js"></script>
    <script src="js/components/settings/shared-link-manager.js"></script>
    <script src="js/components/settings/settings-manager.js"></script>
    <script src="js/components/share-manager.js"></script>
    <script src="js/components/api-tools-manager.js"></script>
    <script src="js/components/prompts-manager.js"></script>
    <script src="js/components/mcp-manager.js"></script>
    <script src="js/components/ai-hackare.js"></script>
    <script src="js/app.js"></script>
    <script src="js/themes.js"></script>
    <script src="js/copy-code.js"></script>
    <script src="js/logo-animation.js"></script>
    <script src="js/settings-tooltip.js"></script>
    <script src="js/link-sharing-tooltip.js"></script>
    <script src="js/mobile-utils.js"></script>
    <script src="js/modal-effects.js"></script>
</body>
</html>
