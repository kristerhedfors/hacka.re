<!DOCTYPE html>
<html lang="en" class="theme-modern">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Animation Test</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/themes.css">
    <style>
        body {
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .test-container {
            margin-bottom: 20px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        button {
            padding: 8px 16px;
            background-color: #6366f1;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        input {
            padding: 8px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        h2 {
            margin-top: 0;
        }
    </style>
    <!-- Markdown parser (local) -->
    <script src="lib/marked/marked.min.js"></script>
    <script src="lib/dompurify/purify.min.js"></script>
    <!-- TweetNaCl for encryption (local) -->
    <script src="lib/tweetnacl/nacl-fast.min.js"></script>
    <script src="lib/tweetnacl/nacl-util.min.js"></script>
</head>
<body>
    <h1>Heart Animation Test</h1>
    
    <div class="test-container">
        <h2>Original Logo</h2>
        <div class="logo">
            <h1 class="logo-text">hacka.re<span class="heart-logo">♥&#xFE0E;
                <!-- SVG fallback for Firefox Focus -->
                <svg class="firefox-focus-fallback" width="16" height="6" viewBox="0 0 16 6" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 3; display: none;">
                    <circle cx="3" cy="3" r="1.5" fill="#22CC22" />
                    <circle cx="8" cy="3" r="1.5" fill="#22CC22" />
                    <circle cx="13" cy="3" r="1.5" fill="#22CC22" />
                </svg>
                <div class="typing-dots"></div>
                <div class="tooltip">
                    <p>This is a tooltip</p>
                </div>
            </span></h1>
            <p class="tagline">Free, open, för hackare, av hackare.</p>
        </div>
    </div>
    
    <div class="test-container">
        <h2>Test Title/Subtitle Update</h2>
        <div>
            <input type="text" id="title-input" placeholder="Enter title" value="Custom Title">
            <input type="text" id="subtitle-input" placeholder="Enter subtitle" value="Custom Subtitle">
            <button id="update-btn">Update Title/Subtitle</button>
            <button id="reset-btn">Reset to Default</button>
        </div>
        <div class="logo" style="margin-top: 20px;">
            <h1 class="logo-text">hacka.re<span class="heart-logo">♥&#xFE0E;
                <!-- SVG fallback for Firefox Focus -->
                <svg class="firefox-focus-fallback" width="16" height="6" viewBox="0 0 16 6" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 3; display: none;">
                    <circle cx="3" cy="3" r="1.5" fill="#22CC22" />
                    <circle cx="8" cy="3" r="1.5" fill="#22CC22" />
                    <circle cx="13" cy="3" r="1.5" fill="#22CC22" />
                </svg>
                <div class="typing-dots"></div>
                <div class="tooltip">
                    <p>This is a tooltip</p>
                </div>
            </span></h1>
            <p class="tagline">Free, open, för hackare, av hackare.</p>
        </div>
    </div>
    
    <div class="test-container">
        <h2>Animation Controls</h2>
        <button id="start-animation">Start Animation</button>
        <button id="stop-animation">Stop Animation</button>
    </div>

    <script src="js/utils/crypto-utils.js"></script>
    <script src="js/services/storage-service.js"></script>
    <script src="js/logo-animation.js"></script>
    <script>
        // Mock StorageService if it doesn't exist
        if (!window.StorageService) {
            window.StorageService = {
                getTitle: function() { return document.getElementById('title-input').value; },
                getSubtitle: function() { return document.getElementById('subtitle-input').value; },
                saveTitle: function(title) { console.log('Title saved:', title); },
                saveSubtitle: function(subtitle) { console.log('Subtitle saved:', subtitle); }
            };
        }
        
        // Include the updateTitleAndSubtitle function from app.js
        window.updateTitleAndSubtitle = function() {
            const title = StorageService.getTitle();
            const subtitle = StorageService.getSubtitle();
            const defaultTitle = "hacka.re";
            const defaultSubtitle = "Free, open, för hackare, av hackare";
            
            // Check if title and subtitle are unchanged (blank or default)
            const isTitleDefault = !title || title === defaultTitle;
            const isSubtitleDefault = !subtitle || subtitle === defaultSubtitle;
            
            // Update main page
            const logoTextElements = document.querySelectorAll('.logo-text');
            const taglineElements = document.querySelectorAll('.tagline');
            
            logoTextElements.forEach(element => {
                // Get the heart logo element
                const heartLogo = element.querySelector('.heart-logo');
                if (heartLogo) {
                    // Clear the element's content except for the heart logo
                    // This preserves the heart logo DOM element and all its event listeners
                    while (element.firstChild) {
                        if (element.firstChild !== heartLogo) {
                            element.removeChild(element.firstChild);
                        } else {
                            // Move the heart logo to a temporary variable to preserve it
                            const tempHeartLogo = heartLogo;
                            element.removeChild(heartLogo);
                            
                            // Create a text node for the title
                            const titleNode = document.createTextNode(title);
                            element.appendChild(titleNode);
                            
                            // Add the heart logo back
                            element.appendChild(tempHeartLogo);
                            
                            // If using default title/subtitle, add the "serverless GPTs" text
                            if (isTitleDefault && isSubtitleDefault) {
                                const serverlessSpan = document.createElement('span');
                                serverlessSpan.className = 'serverless-gpts';
                                serverlessSpan.innerHTML = ' serverless <span class="gpts">GPTs</span>';
                                element.appendChild(serverlessSpan);
                            }
                            
                            break;
                        }
                    }
                } else {
                    element.textContent = title;
                }
            });
            
            taglineElements.forEach(element => {
                element.textContent = subtitle;
            });
            
            // Update document title
            document.title = title + ' - ' + subtitle;
            
            console.log(`Title and subtitle updated to: ${title} - ${subtitle}`);
        };
        
        // Set up event listeners
        document.getElementById('update-btn').addEventListener('click', function() {
            updateTitleAndSubtitle();
        });
        
        document.getElementById('reset-btn').addEventListener('click', function() {
            document.getElementById('title-input').value = 'hacka.re';
            document.getElementById('subtitle-input').value = 'Free, open, för hackare, av hackare';
            updateTitleAndSubtitle();
        });
        
        document.getElementById('start-animation').addEventListener('click', function() {
            if (window.LogoAnimation && window.LogoAnimation.start) {
                window.LogoAnimation.start();
                console.log('Animation started');
            }
        });
        
        document.getElementById('stop-animation').addEventListener('click', function() {
            if (window.LogoAnimation && window.LogoAnimation.stop) {
                window.LogoAnimation.stop();
                console.log('Animation stopped');
            }
        });
        
        // Trigger a custom event to start the animation for testing
        document.getElementById('start-animation').addEventListener('click', function() {
            document.dispatchEvent(new CustomEvent('ai-response-start'));
        });
        
        document.getElementById('stop-animation').addEventListener('click', function() {
            document.dispatchEvent(new CustomEvent('ai-response-end'));
        });
    </script>
</body>
</html>
