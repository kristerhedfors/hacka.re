/* Mobile Chat Input Fix - Ensures visibility on Safari and Chrome mobile */

/* Critical: Override problematic body positioning on mobile */
@media (max-width: 768px) {
    /* Fix body positioning that breaks bottom elements */
    body:not(.modal-open) {
        position: relative !important; /* Changed from fixed */
        overflow: hidden !important;
        height: 100vh;
        height: -webkit-fill-available; /* iOS safe */
        height: calc(var(--vh, 1vh) * 100);
    }

    /* Ensure main takes full height */
    main {
        height: 100%;
        display: flex;
        flex-direction: column;
        min-height: 0;
    }

    /* Fix chat container flex layout */
    #chat-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;
        height: 100%;
        padding: 0.5rem;
        overflow: hidden; /* Prevent container scroll */
    }

    /* Ensure messages scroll properly */
    #chat-messages {
        flex: 1;
        min-height: 0;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 10px;
    }

    /* Fix input container positioning */
    #chat-input-container {
        position: relative !important; /* Not fixed or sticky */
        flex-shrink: 0;
        margin-top: auto; /* Push to bottom */
        background-color: var(--light-color) !important;
        border-top: 1px solid var(--border-color);
        padding: 0.75rem;
        padding-bottom: calc(0.75rem + env(safe-area-inset-bottom, 0));
        z-index: 10;
        width: 100%;
        box-sizing: border-box;
    }

    /* Ensure input controls are visible */
    #chat-input-container .input-with-actions {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        width: 100%;
    }

    /* Fix button visibility */
    #chat-input-container button {
        flex-shrink: 0;
        min-width: 44px; /* iOS touch target */
        min-height: 44px;
        display: flex !important;
        align-items: center;
        justify-content: center;
        visibility: visible !important;
        opacity: 1 !important;
    }

    /* Ensure textarea is visible */
    #user-input {
        flex: 1;
        min-height: 44px;
        visibility: visible !important;
        opacity: 1 !important;
    }

    /* Handle keyboard appearance */
    .keyboard-open #chat-messages {
        /* Reduce messages area when keyboard appears */
        padding-bottom: 20px;
    }

    /* Visual Viewport API support for modern browsers */
    @supports (height: 100dvh) {
        body:not(.modal-open) {
            height: 100dvh;
        }
        
        #chat-container {
            height: 100dvh;
        }
    }

    /* iOS-specific fixes */
    @supports (-webkit-touch-callout: none) {
        /* iOS Safari */
        body:not(.modal-open) {
            position: relative !important;
            height: -webkit-fill-available;
        }

        #chat-container {
            height: 100%;
        }

        #chat-input-container {
            -webkit-transform: translate3d(0, 0, 0); /* Force GPU acceleration */
            transform: translate3d(0, 0, 0);
        }
    }

    /* Chrome mobile specific */
    @media (display-mode: browser) {
        #chat-input-container {
            position: relative !important;
        }
    }
    
    /* iOS Chrome specific fixes */
    @supports (-webkit-appearance: none) and (stroke-color: transparent) {
        /* This targets Chrome on iOS */
        .keyboard-open #chat-container {
            /* Prevent container from scrolling when keyboard opens */
            overflow: hidden;
        }
        
        .keyboard-open #chat-messages {
            /* Adjust messages area height when keyboard is open */
            max-height: calc(100vh - 300px); /* Account for keyboard height */
            max-height: calc(100dvh - 300px);
        }
        
        .keyboard-open #chat-input-container {
            /* Ensure input stays at bottom and visible */
            position: fixed !important;
            bottom: 0 !important;
            left: 0 !important;
            right: 0 !important;
            transform: translateZ(0); /* Force hardware acceleration */
            -webkit-transform: translateZ(0);
        }
    }
}

/* Landscape orientation adjustments */
@media (max-width: 768px) and (orientation: landscape) {
    #chat-input-container {
        padding: 0.5rem;
        padding-bottom: calc(0.5rem + env(safe-area-inset-bottom, 0));
    }

    #chat-messages {
        padding: 0.5rem;
    }
}

/* High-contrast mode for debugging */
@media (prefers-contrast: high) {
    #chat-input-container {
        border: 2px solid red !important;
    }
}

/* Debug: Add visual indicator for input container */
#chat-input-container::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, 
        transparent 0%, 
        var(--primary-color) 50%, 
        transparent 100%);
    pointer-events: none;
}