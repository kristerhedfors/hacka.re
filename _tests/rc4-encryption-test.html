<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RC4 Encryption/Decryption Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        button {
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        .error {
            border-left: 4px solid #f44336;
        }
        textarea {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
            font-family: monospace;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        .function-container {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        h2 {
            margin-top: 30px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
    </style>
    <!-- Include the RC4 utility script -->
    <script src="../js/utils/rc4-utils.js"></script>
</head>
<body>
    <h1>RC4 Encryption/Decryption Test</h1>
    <p>This page tests the RC4 encryption/decryption functionality and demonstrates error handling for function calling.</p>
    
    <div class="function-container">
        <h2>RC4 Encryption</h2>
        <div class="input-group">
            <label for="encrypt-plaintext">Plaintext:</label>
            <textarea id="encrypt-plaintext" placeholder="Enter text to encrypt"></textarea>
        </div>
        <div class="input-group">
            <label for="encrypt-key">Encryption Key:</label>
            <input type="text" id="encrypt-key" placeholder="Enter encryption key">
        </div>
        <button id="encrypt-btn">Encrypt</button>
        <div id="encrypt-result" class="result" style="display: none;"></div>
    </div>
    
    <div class="function-container">
        <h2>RC4 Decryption</h2>
        <div class="input-group">
            <label for="decrypt-ciphertext">Ciphertext (hex):</label>
            <textarea id="decrypt-ciphertext" placeholder="Enter hex ciphertext to decrypt"></textarea>
        </div>
        <div class="input-group">
            <label for="decrypt-key">Decryption Key:</label>
            <input type="text" id="decrypt-key" placeholder="Enter decryption key">
        </div>
        <button id="decrypt-btn">Decrypt</button>
        <div id="decrypt-result" class="result" style="display: none;"></div>
    </div>
    
    <div class="function-container">
        <h2>Test Implementation</h2>
        <p>Test the RC4 implementation with a known test vector.</p>
        <button id="test-implementation-btn">Run Test</button>
        <div id="test-implementation-result" class="result" style="display: none;"></div>
    </div>
    
    <div class="function-container">
        <h2>Error Handling Tests</h2>
        <button id="test-missing-params-btn">Test Missing Parameters</button>
        <button id="test-invalid-hex-btn">Test Invalid Hex</button>
        <div id="error-test-result" class="result" style="display: none;"></div>
    </div>
    
    <h2>Function Definitions</h2>
    <pre id="function-definitions">
// RC4 Encrypt Function
function rc4_encrypt(plaintext, key) {
  // This function uses the RC4Utils module to encrypt data
  if (!plaintext || !key) {
    throw new Error("Both plaintext and key are required");
  }
  
  try {
    const encrypted = RC4Utils.encrypt(plaintext, key);
    return {
      success: true,
      plaintext: plaintext,
      key: key,
      encrypted: encrypted
    };
  } catch (error) {
    return {
      success: false,
      error: error.message
    };
  }
}

// RC4 Decrypt Function
function rc4_decrypt(ciphertext, key) {
  // This function uses the RC4Utils module to decrypt data
  if (!ciphertext || !key) {
    throw new Error("Both ciphertext and key are required");
  }
  
  try {
    const decrypted = RC4Utils.decrypt(ciphertext, key);
    return {
      success: true,
      ciphertext: ciphertext,
      key: key,
      decrypted: decrypted
    };
  } catch (error) {
    return {
      success: false,
      error: error.message
    };
  }
}

// RC4 Test Implementation Function
function rc4_test() {
  // This function tests the RC4 implementation
  try {
    const result = RC4Utils.testImplementation();
    return result;
  } catch (error) {
    return {
      success: false,
      error: error.message
    };
  }
}
    </pre>
    
    <script>
        // Event listeners
        document.getElementById('encrypt-btn').addEventListener('click', encryptText);
        document.getElementById('decrypt-btn').addEventListener('click', decryptText);
        document.getElementById('test-implementation-btn').addEventListener('click', testImplementation);
        document.getElementById('test-missing-params-btn').addEventListener('click', testMissingParams);
        document.getElementById('test-invalid-hex-btn').addEventListener('click', testInvalidHex);
        
        // Encrypt text
        function encryptText() {
            try {
                const plaintext = document.getElementById('encrypt-plaintext').value;
                const key = document.getElementById('encrypt-key').value;
                
                if (!plaintext || !key) {
                    throw new Error('Both plaintext and key are required');
                }
                
                const result = RC4Utils.encrypt(plaintext, key);
                
                showResult('encrypt-result', {
                    success: true,
                    plaintext: plaintext,
                    key: key,
                    encrypted: result
                }, false);
            } catch (error) {
                showResult('encrypt-result', {
                    success: false,
                    error: error.message
                }, true);
            }
        }
        
        // Decrypt text
        function decryptText() {
            try {
                const ciphertext = document.getElementById('decrypt-ciphertext').value;
                const key = document.getElementById('decrypt-key').value;
                
                if (!ciphertext || !key) {
                    throw new Error('Both ciphertext and key are required');
                }
                
                // Validate hex format
                if (!/^[0-9a-fA-F]+$/.test(ciphertext)) {
                    throw new Error('Ciphertext must be in hexadecimal format');
                }
                
                const result = RC4Utils.decrypt(ciphertext, key);
                
                showResult('decrypt-result', {
                    success: true,
                    ciphertext: ciphertext,
                    key: key,
                    decrypted: result
                }, false);
            } catch (error) {
                showResult('decrypt-result', {
                    success: false,
                    error: error.message
                }, true);
            }
        }
        
        // Test implementation
        function testImplementation() {
            try {
                const result = RC4Utils.testImplementation();
                showResult('test-implementation-result', result, !result.success);
            } catch (error) {
                showResult('test-implementation-result', {
                    success: false,
                    error: error.message
                }, true);
            }
        }
        
        // Test missing parameters
        function testMissingParams() {
            try {
                // Call encrypt without parameters
                const result = rc4_encrypt();
                showResult('error-test-result', result, true);
            } catch (error) {
                showResult('error-test-result', {
                    success: false,
                    error: error.message
                }, true);
            }
        }
        
        // Test invalid hex
        function testInvalidHex() {
            try {
                // Call decrypt with invalid hex
                const result = rc4_decrypt('not-a-hex-string', 'key');
                showResult('error-test-result', result, true);
            } catch (error) {
                showResult('error-test-result', {
                    success: false,
                    error: error.message
                }, true);
            }
        }
        
        // Helper function to show results
        function showResult(elementId, result, isError) {
            const resultElement = document.getElementById(elementId);
            resultElement.textContent = JSON.stringify(result, null, 2);
            resultElement.style.display = 'block';
            
            if (isError) {
                resultElement.classList.add('error');
            } else {
                resultElement.classList.remove('error');
            }
        }
        
        // Define the functions for testing
        function rc4_encrypt(plaintext, key) {
            // This function uses the RC4Utils module to encrypt data
            if (!plaintext || !key) {
                throw new Error("Both plaintext and key are required");
            }
            
            try {
                const encrypted = RC4Utils.encrypt(plaintext, key);
                return {
                    success: true,
                    plaintext: plaintext,
                    key: key,
                    encrypted: encrypted
                };
            } catch (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
        }
        
        function rc4_decrypt(ciphertext, key) {
            // This function uses the RC4Utils module to decrypt data
            if (!ciphertext || !key) {
                throw new Error("Both ciphertext and key are required");
            }
            
            try {
                // Validate hex format
                if (!/^[0-9a-fA-F]+$/.test(ciphertext)) {
                    throw new Error('Ciphertext must be in hexadecimal format');
                }
                
                const decrypted = RC4Utils.decrypt(ciphertext, key);
                return {
                    success: true,
                    ciphertext: ciphertext,
                    key: key,
                    decrypted: decrypted
                };
            } catch (error) {
                return {
                    success: false,
                    error: error.message
                };
            }
        }
    </script>
</body>
</html>
