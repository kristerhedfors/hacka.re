<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Share Link MCP - Debug Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 40px; 
            line-height: 1.6;
        }
        .debug-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .service-check {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        .status-ok { color: #28a745; }
        .status-error { color: #dc3545; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .result {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Share Link MCP - Debug Test</h1>
    
    <div class="debug-section">
        <h2>Service Availability Check</h2>
        <div id="service-status"></div>
        <button onclick="checkServices()">Check Services</button>
    </div>
    
    <div class="debug-section">
        <h2>Basic Functionality Test</h2>
        <button onclick="testBasicFunction()">Test Basic Function</button>
        <button onclick="testCheckAvailable()">Test Check Available</button>
        <button onclick="testGenerateLink()">Test Generate Link</button>
        <div id="test-results"></div>
    </div>
    
    <div class="debug-section">
        <h2>Console Output</h2>
        <div id="console-output"></div>
        <button onclick="clearConsole()">Clear Console</button>
    </div>
    
    <script>
        // Capture console messages
        const originalConsole = {
            log: console.log,
            error: console.error,
            warn: console.warn
        };
        
        const consoleMessages = [];
        
        function addConsoleMessage(type, ...args) {
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
            ).join(' ');
            
            consoleMessages.push(`[${type.toUpperCase()}] ${message}`);
            updateConsoleDisplay();
            
            // Call original console method
            originalConsole[type](...args);
        }
        
        console.log = (...args) => addConsoleMessage('log', ...args);
        console.error = (...args) => addConsoleMessage('error', ...args);
        console.warn = (...args) => addConsoleMessage('warn', ...args);
        
        function updateConsoleDisplay() {
            const output = document.getElementById('console-output');
            output.innerHTML = consoleMessages.slice(-20).join('\\n');
        }
        
        function clearConsole() {
            consoleMessages.length = 0;
            updateConsoleDisplay();
        }
        
        function checkServices() {
            const services = {
                'MCPShareLinkService': window.MCPShareLinkService,
                'MCPShareLinkUI': window.MCPShareLinkUI,
                'DefaultPromptsService': window.DefaultPromptsService,
                'FunctionToolsService': window.FunctionToolsService,
                'ShareService': window.ShareService,
                'CoreStorageService': window.CoreStorageService,
                'StorageService': window.StorageService
            };
            
            let html = '<h3>Service Status:</h3>';
            
            Object.entries(services).forEach(([name, service]) => {
                const status = service ? 'status-ok' : 'status-error';
                const icon = service ? '✅' : '❌';
                html += `<div class="service-check"><span class="${status}">${icon} ${name}</span></div>`;
            });
            
            document.getElementById('service-status').innerHTML = html;
            console.log('Service check completed');
        }
        
        async function testBasicFunction() {
            try {
                if (window.MCPShareLinkService) {
                    console.log('MCPShareLinkService is available');
                    console.log('Available methods:', Object.keys(window.MCPShareLinkService));
                } else {
                    console.error('MCPShareLinkService not available');
                }
            } catch (error) {
                console.error('Basic test error:', error);
            }
        }
        
        async function testCheckAvailable() {
            const resultDiv = document.getElementById('test-results');
            
            try {
                if (!window.MCPShareLinkService) {
                    throw new Error('MCPShareLinkService not available');
                }
                
                console.log('Testing checkAvailableContent...');
                const result = await window.MCPShareLinkService.checkAvailableContent();
                
                resultDiv.innerHTML = `<div class="result">Check Available Result:\\n${JSON.stringify(result, null, 2)}</div>`;
                console.log('checkAvailableContent result:', result);
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="result">Error: ${error.message}</div>`;
                console.error('testCheckAvailable error:', error);
            }
        }
        
        async function testGenerateLink() {
            const resultDiv = document.getElementById('test-results');
            
            try {
                if (!window.MCPShareLinkService) {
                    throw new Error('MCPShareLinkService not available');
                }
                
                console.log('Testing generateShareLink...');
                const result = await window.MCPShareLinkService.generateShareLink({
                    includeApiKey: true,
                    includeModel: true
                });
                
                if (result.success) {
                    resultDiv.innerHTML = `<div class="result">Generate Link Success!\\nPassword: ${result.password}\\nLink Length: ${result.link.length}\\nLink: ${result.link.substring(0, 100)}...</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="result">Generate Link Failed: ${result.error}</div>`;
                }
                console.log('generateShareLink result:', result);
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="result">Error: ${error.message}</div>`;
                console.error('testGenerateLink error:', error);
            }
        }
        
        // Auto-check services on load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('Page loaded, checking services...');
            setTimeout(() => {
                checkServices();
                console.log('Window object keys:', Object.keys(window).filter(k => k.includes('Service')));
            }, 1000);
        });
        
    </script>
</body>
</html>